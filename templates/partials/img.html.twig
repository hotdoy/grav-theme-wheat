{% set image = image ?? null %}
{% if image %}
    {% set alt = alt ?? null %}
    {% set title = title ?? null %}
    {% set width = image ? image.width : null %}
    {% set height = image ? image.height : null %}
    {% set type =  image ? image.type : null %}
    {% set system_quality = system.images.default_image_quality ?? '85' %}
    {% set quality = image.quality matches '/^\\d+$/' ? image.quality > system_quality ? system_quality : image.quality %}
    {% set bypass = image ? '_bypass' in image.filename : false %}

    {% if type != 'vector' %}
    {% set ph = 'data:' ~ image.mime ~ ';base64,' ~ filecontent(image.cropResize(128,128).url)|base64_encode %}
    {% set style = 'background-image:url(' ~ ph ~ ');background-size:cover;background-position:center;' %}
    {% endif %}

    {% if type == 'vector' %}
    {{ image.loading.html(title, alt)|raw }}
    {% elseif bypass %}
    {{ image.attribute('style', style).attribute('width', width).attribute('height', height).loading.html(title, alt)|raw }}
    {% else %}
    {{ image.attribute('style', style).attribute('width', width).attribute('height', height).quality(quality).loading.html(title, alt)|raw }}
    {% endif %}
{% endif %}

