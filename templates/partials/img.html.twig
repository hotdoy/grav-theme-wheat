{% set image = image ?? null %}

{% if image %}
    {% set alt = alt ?? null %}
    {% set title = title ?? null %}
    {% set width = image ? image.width : null %}
    {% set height = image ? image.height : null %}
    {% set style = '' %}
    {% set type =  image ? image.type : null %}
    {% set system_quality = system.images.default_image_quality ?? '85' %}
    {% set quality = image.quality matches '/^\\d+$/' ? image.quality > system_quality ? system_quality : image.quality %}
    {% set loading = loading ?? page.header.image_loading ?? 'lazy' %}
    {% set bypass = image ? '_bypass' in image.filename : false %}

    {# PLACEHOLDER #}
    {# {% if type != 'vector' -%}
        {% set base64 = 'data:' ~ image.mime ~ ';base64,' ~ filecontent(image.cropResize(16,16).url)|base64_encode %}
        {%- set style -%}
        background-image:url('{{ base64 }}');background-size:cover;background-position:center;filter:blur(20px);
        {%- endset -%}
    {% endif %} #}

    {# IMAGE #}
    {% if type == 'vector' %}
        {{ image.loading.html(title, alt)|raw }}
    {% elseif bypass %}
        {{ image.attribute('style', style).attribute('width', width).attribute('height', height).loading(loading).html(title, alt)|raw }}
    {% else %}
        {{ image.derivatives(320,1920).attribute('style', style).attribute('width', width).attribute('height', height).quality(quality).loading(loading).sizes('(max-width:26em) 100vw, 50vw').html(title, alt)|raw }}
    {% endif %}
{% endif %}

